# Сквозное задание

> [!Выбран вариант второй]
> Реализовать локальное хранилище для информации по аналитическим и балансовым счетам. Информация по счетам обновляется 4 раза в день, забирается из накопленного источника (внешняя БД). Фактические данные – проводки по счетам.
> 
> Форматы данных: табличные

# Лекция 1: Практическое задание 


> [!Задание первое]
> Подготовить сравнительную таблицу по архитектурным подходам к построению хранилищ данных. Описать: плюсы подхода, минусы подхода, критерий для выбора.

### Сравнительная таблица архитектурных подходов к построению хранилищ данных

| **Архитектурный подход**                                          | **Плюсы**                                                                                                                                                                                                            | **Минусы**                                                                                                                                                                             | **Критерии выбора**                                                                                       |
| ----------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| **B.Inmon (Фабрика дынных)**                                      | - Высокая целостность данных.<br>- Нормализованная структура (3NF).<br>- Единый источник правды (EDW). <br>- Легко поддерживать при увеличении количества источников.<br>- Отсутствие противоречивости в данных      | - Сложность реализации.<br>- Долгий цикл разработки на начальной стадии разработки.<br>- Высокая стоимость.<br>- Высокие требования к квалификации команды.                            | - Требуется единая версия данных для всей организации.<br>- Строгие требования к согласованности.         |
| **R.Kimball ( Корпоративная шина данных, Star/Snowflake Schema)** | - Быстрый эффект за счет быстрой реализации.<br>- Простота для аналитиков (денормализация).<br>- Быстрые запросы.<br>- Легкая масштабируемость витрин.<br>- Не требует высокой квалификации специалистов (на старте) | - Высокая стоимость поддержки новых источников<br>- Сложность поддержки изменений в измерениях.<br>- Отсутствие стандартизации показателей (в каждой витрине может быть свой алгоритм) | - Фокус на аналитику и отчетность.<br>- Быстрый старт для MVP.<br>- Частые запросы с агрегациями.<br><br> |
### **Резюме по выбору подхода**
1. **Inmon** — для крупных корпораций с жесткими требованиями к целостности данных.
2. **Kimball** — для быстрого старта аналитики и отчетности.
---

> [!Задание второе (сквозной проект)]
> Выбрать тип будущего хранилища данных. Обосновать свой подход.  
> Выбрать кол-во слоев в хранилище. Описать выбранные слои и обосновать свой выбор.

### **1. Выбор типа хранилища**
**Data Warehouse (DWH)** чаще всего используют для аналитических задач. Но если данные не очень большие и нужна скорость, может подойти **Data Lake** или гибридное решение. 
**Тип хранилища:** **Data Warehouse (DWH)**.  
 **Обоснование:**  
- Данные табличные, структурированные и требуют частых обновлений (4 раза в день).  
- Необходима поддержка сложных аналитических запросов, агрегаций и историчности (например, отслеживание изменений состояния счетов).  
- DWH обеспечивает:  
  - Высокую производительность для OLAP-запросов.  
  - Возможность хранения исторических данных (версионирование).  
  - Интеграцию данных из внешних источников.  
**Почему не Data Lake?**  
- Данные структурированы, не требуют хранения необработанных файлов.  
- Нет необходимости в обработке (не/полу)структурированных данных (JSON, CSV).  
---
### **2. Количество слоев и их структура**
**Архитектура:** **3 слоя** (Staging → Core → Marts).  

#### **Staging (сырые данные)**  
**Назначение:**  
- Временное хранение данных, загруженных из внешней БД.  
- Обеспечение изоляции исходных данных от последующих преобразований.  

**Особенности:**  
- Данные сохраняются в неизменном виде (как во внешнем источнике).  
- Частота обновлений: 4 раза в день (репликация или инкрементальная загрузка).  
- Формат: Таблицы, дублирующие структуру внешней БД.  

**Обоснование:**  
- Позволяет избежать нагрузки на внешний источник при ошибках в ETL.  
- Упрощает отладку и проверку данных перед обработкой.  
- Изолирует сырые данные, что упрощает повторную загрузку при ошибках.  

**Пример технологии:**  
- Отдельная схема в PostgreSQL/GreenPlum или выделенная БД.  
---
#### **Core layer(ядро хранилища)**  
**Назначение:**  
- Очистка, нормализация и обогащение данных.  
- Обеспечение историчности (SCD2 — медленно меняющиеся измерения).  

**Особенности:**  
- **Очистка:** Удаление дубликатов, обработка NULL, валидация форматов.  
- **Трансформация:**  
  - Объединение данных из разных источников (например, аналитические и балансовые счета).  
  - Расчет производных метрик (остатки, обороты).  
- **Версионирование:** Хранение истории изменений счетов (например, через SCD2).  

**Обоснование:**  
- Гарантирует целостность и согласованность данных.
- Единая версия правды.  
- Позволяет анализировать исторические изменения (аудит, восстановление состояний).  

**Пример технологии:**  
- Таблицы с полями `valid_from` и `valid_to` для отслеживания изменений.  
- DAG в Airflow для автоматизации ETL или процедуры.  
---
#### **Marts (витрины данных)**  
**Назначение:**  
- Подготовка данных для конкретных аналитических задач.  
- Оптимизация производительности отчетов и дашбордов.  

**Особенности:**  
- **Витрины:**  
  - Балансовые отчеты (остатки на счетах на конец дня).  
  - Аналитические отчеты (обороты по счетам, распределение по статьям).  
- Даные денормализованы для ускорения запросов.  

**Обоснование:**  
- Снижает нагрузку на Core-слой при выполнении частых запросов.  
- Упрощает работу аналитиков: данные готовы к использованию без сложных JOIN.  
- 
**Пример технологии:**  
- Материализованные представления или предрассчитанные таблицы.  
- Индексы и партицирование по дате/счету.  
---